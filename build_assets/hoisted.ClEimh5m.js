import{Q as It,R as Ct,k as Tt}from"./lit-html.CzCPjovT.js";import{$ as _}from"./_.D20LIu99.js";import"./hoisted.DvC32OUy.js";class S{static LEVEL_DEBUG=0;static LEVEL_INFO=1;static LEVEL_WARNING=2;static LEVEL_ERROR=3;static LEVEL_IMPORTANT=4;static#s="gray";static#n="white";static#i="yellow";static#a="red";static#c="blue";#o;#t;constructor(t,e){this.#o=t,this.#t=e}#e(t,e){if(typeof t=="object"){console.log(`%c${this.#o}: ⬇︎`,`color: ${e}`),console.log(t);return}console.log(`%c${this.#o}: ${t}`,`color: ${e}`)}debug(t){this.#t<=S.LEVEL_DEBUG&&this.#e(t,S.#s)}info(t){this.#t<=S.LEVEL_INFO&&this.#e(t,S.#n)}warning(t){this.#t<=S.LEVEL_WARNING&&this.#e(t,S.#i)}error(t){this.#t<=S.LEVEL_ERROR&&this.#e(t,S.#a)}important(t){this.#t<=S.LEVEL_IMPORTANT&&this.#e(t,S.#c)}}const Nt=s=>crypto.subtle.digest("SHA-256",s);var kt=5960464477539063e-23,ot=4294967296,ht=9007199254740992;function Vt(s){var t=new ArrayBuffer(256),e=new DataView(t),o,n=0;function i(r){for(var f=t.byteLength,v=n+r;f<v;)f<<=1;if(f!==t.byteLength){var y=e;t=new ArrayBuffer(f),e=new DataView(t);for(var E=n+3>>2,u=0;u<E;++u)e.setUint32(u<<2,y.getUint32(u<<2))}return o=r,e}function a(){n+=o}function l(r){a(i(8).setFloat64(n,r))}function c(r){a(i(1).setUint8(n,r))}function p(r){for(var f=i(r.length),v=0;v<r.length;++v)f.setUint8(n+v,r[v]);a()}function h(r){a(i(2).setUint16(n,r))}function w(r){a(i(4).setUint32(n,r))}function m(r){var f=r%ot,v=(r-f)/ot,y=i(8);y.setUint32(n,v),y.setUint32(n+4,f),a()}function b(r,f){f<24?c(r<<5|f):f<256?(c(r<<5|24),c(f)):f<65536?(c(r<<5|25),h(f)):f<4294967296?(c(r<<5|26),w(f)):(c(r<<5|27),m(f))}function A(r){var f;if(r===!1)return c(244);if(r===!0)return c(245);if(r===null)return c(246);if(r===void 0)return c(247);switch(typeof r){case"number":if(Math.floor(r)===r){if(0<=r&&r<=ht)return b(0,r);if(-ht<=r&&r<0)return b(1,-(r+1))}return c(251),l(r);case"string":var v=[];for(f=0;f<r.length;++f){var y=r.charCodeAt(f);y<128?v.push(y):y<2048?(v.push(192|y>>6),v.push(128|y&63)):y<55296?(v.push(224|y>>12),v.push(128|y>>6&63),v.push(128|y&63)):(y=(y&1023)<<10,y|=r.charCodeAt(++f)&1023,y+=65536,v.push(240|y>>18),v.push(128|y>>12&63),v.push(128|y>>6&63),v.push(128|y&63))}return b(3,v.length),p(v);default:var E;if(Array.isArray(r))for(E=r.length,b(4,E),f=0;f<E;++f)A(r[f]);else if(r instanceof Uint8Array)b(2,r.length),p(r);else{var u=Object.keys(r);for(E=u.length,b(5,E),f=0;f<E;++f){var g=u[f];A(g),A(r[g])}}}}if(A(s),"slice"in t)return t.slice(0,n);for(var $=new ArrayBuffer(n),x=new DataView($),I=0;I<n;++I)x.setUint8(I,e.getUint8(I));return $}function Bt(s,t,e){var o=new DataView(s),n=0;typeof t!="function"&&(t=function(v){return v}),typeof e!="function"&&(e=function(){});function i(v,y){return n+=v,y}function a(v){return i(v,new Uint8Array(s,n,v))}function l(){var v=new ArrayBuffer(4),y=new DataView(v),E=w(),u=E&32768,g=E&31744,R=E&1023;if(g===31744)g=261120;else if(g!==0)g+=114688;else if(R!==0)return(u?-1:1)*R*kt;return y.setUint32(0,u<<16|g<<13|R<<13),y.getFloat32(0)}function c(){return i(4,o.getFloat32(n))}function p(){return i(8,o.getFloat64(n))}function h(){return i(1,o.getUint8(n))}function w(){return i(2,o.getUint16(n))}function m(){return i(4,o.getUint32(n))}function b(){return m()*ot+m()}function A(){return o.getUint8(n)!==255?!1:(n+=1,!0)}function $(v){if(v<24)return v;if(v===24)return h();if(v===25)return w();if(v===26)return m();if(v===27)return b();if(v===31)return-1;throw"Invalid length encoding"}function x(v){var y=h();if(y===255)return-1;var E=$(y&31);if(E<0||y>>5!==v)throw"Invalid indefinite length element";return E}function I(v,y){for(var E=0;E<y;++E){var u=h();u&128&&(u<224?(u=(u&31)<<6|h()&63,y-=1):u<240?(u=(u&15)<<12|(h()&63)<<6|h()&63,y-=2):(u=(u&15)<<18|(h()&63)<<12|(h()&63)<<6|h()&63,y-=3)),u<65536?v.push(u):(u-=65536,v.push(55296|u>>10),v.push(56320|u&1023))}}function r(){var v=h(),y=v>>5,E=v&31,u,g;if(y===7)switch(E){case 25:return l();case 26:return c();case 27:return p()}if(g=$(E),g<0&&(y<2||6<y))throw"Invalid length";switch(y){case 0:return g;case 1:return-1-g;case 2:if(g<0){for(var R=[],lt=0;(g=x(y))>=0;)lt+=g,R.push(a(g));var vt=new Uint8Array(lt),yt=0;for(u=0;u<R.length;++u)vt.set(R[u],yt),yt+=R[u].length;return vt}return a(g);case 3:var Q=[];if(g<0)for(;(g=x(y))>=0;)I(Q,g);else I(Q,g);return String.fromCharCode.apply(null,Q);case 4:var B;if(g<0)for(B=[];!A();)B.push(r());else for(B=new Array(g),u=0;u<g;++u)B[u]=r();return B;case 5:var dt={};for(u=0;u<g||g<0&&!A();++u){var xt=r();dt[xt]=r()}return dt;case 6:return t(r(),g);case 7:switch(g){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;default:return e(g)}}}var f=r();if(n!==s.byteLength)throw"Remaining bytes";return f}const st={encode:Vt,decode:Bt};let D=new S("mcumgr",S.LEVEL_DEBUG);const T={EOK:0,EUNKNOWN:1,ENOMEM:2,EINVAL:3,ETIMEOUT:4,ENOENT:5,EBADSTATE:6,EMSGSIZE:7,ENOTSUP:8,ECORRUPT:9,EBUSY:10,EACCESSDENIED:11,UNSUPPORTED_TOO_OLD:12,UNSUPPORTED_TOO_NEW:13,EPERUSER:256},O={READ:0,READ_RSP:1,WRITE:2,WRITE_RSP:3};class Ht{constructor(){this.device=null,this.service=null,this.characteristic=null,this.mtu=250,this.buffer=new Uint8Array([]),this.smpSequenceNumber=0,this.responseResolvers={},this.state={type:"disconnected"},this.onConnect=null,this.onDisconnect=null,this.onConnecting=null,this.onConnectionLoss=null,this.onConnectionReestablished=null,this.onDeviceSelection=null,this.onDeviceSelectionCancel=null,this.SMP_SERVICE_UUID="8d53dc1d-1db7-4cd3-868b-8a527460aa84",this.SMP_CHARACTERISTIC_UUID="da2e7828-fbce-4e01-ae9e-261174997c48",this.SMP_HEADER_SIZE=8,this.SMP_HEADER_OP_IDX=0,this.SMP_HEADER_FLAGS_IDX=1,this.SMP_HEADER_LEN_HI_IDX=2,this.SMP_HEADER_LEN_LO_IDX=3,this.SMP_HEADER_GROUP_HI_IDX=4,this.SMP_HEADER_GROUP_LO_IDX=5,this.SMP_HEADER_SEQ_IDX=6,this.SMP_HEADER_ID_IDX=7}async _requestDevice(t){const e={optionalServices:[this.SMP_SERVICE_UUID]};return t?e.filters=t:e.acceptAllDevices=!0,this.onDeviceSelection?.(),navigator.bluetooth.requestDevice(e)}async connect(t){if(this.state.type!=="disconnected"){console.warn("Already connecting or connected.");return}this.state={type:"selectingDevice"};try{this.device=await this._requestDevice(t),this.state={type:"connecting"},this.onConnecting?.(),console.debug(`Connecting to device ${this.device.name}...`),this.device.addEventListener("gattserverdisconnected",this._handleDisconnection.bind(this)),await this._connectDevice()}catch(e){e.name==="NotFoundError"?(console.debug("Device selection canceled."),this.state={type:"disconnected"},this.onDeviceSelectionCancel?.()):(console.error("Connection error:",e),await this._handleDisconnected())}}async _connectDevice(){if(!this.device){console.error("No device to connect to");return}try{const t=await this.device.gatt.connect();console.debug("Server connected. Awaiting SMP service..."),this.service=await t.getPrimaryService(this.SMP_SERVICE_UUID),console.debug("Service connected."),this.characteristic=await this.service.getCharacteristic(this.SMP_CHARACTERISTIC_UUID),this.characteristic.addEventListener("characteristicvaluechanged",this._notification.bind(this)),await this.characteristic.startNotifications(),(this.state.type==="connecting"||this.state.type==="connectionLoss")&&(this.state.type==="connectionLoss"?this.onConnectionReestablished?.():this.onConnect?.(),this.state={type:"connected"})}catch(t){console.error("Error during connection:",t),await this._handleDisconnected()}}disconnect(){if(this.state.type!=="connected"){console.warn("Cannot disconnect because not connected.");return}this.state={type:"disconnecting"},this.device&&this.device.gatt&&this.device.gatt.disconnect()}async _handleDisconnection(){console.debug("Device disconnected"),this.state.type==="connected"?(this.state={type:"connectionLoss"},this.onConnectionLoss?.(),await this._reconnect()):this.state.type==="disconnecting"&&await this._handleDisconnected()}async _reconnect(){try{await new Promise(t=>setTimeout(t,1e3)),await this._connectDevice()}catch(t){console.error("Reconnection error:",t)}}async _handleDisconnected(){this.state={type:"disconnected"},this.onDisconnect?.(),this.device=null,this.service=null,this.characteristic=null}get name(){return this.device?.name}get maxPayloadSize(){return this.mtu-3-this.SMP_HEADER_SIZE}_buildSMPMessage(t,e,o,n,i,a=new Uint8Array([])){const l=a.length,c=new Uint8Array(this.SMP_HEADER_SIZE);return c[this.SMP_HEADER_OP_IDX]=t,c[this.SMP_HEADER_FLAGS_IDX]=e,c[this.SMP_HEADER_LEN_HI_IDX]=l>>8&255,c[this.SMP_HEADER_LEN_LO_IDX]=l&255,c[this.SMP_HEADER_GROUP_HI_IDX]=o>>8&255,c[this.SMP_HEADER_GROUP_LO_IDX]=o&255,c[this.SMP_HEADER_SEQ_IDX]=n,c[this.SMP_HEADER_ID_IDX]=i,new Uint8Array([...c,...a])}async sendMessage(t,e,o,n=new Uint8Array([])){const i=this.smpSequenceNumber;this.smpSequenceNumber=(this.smpSequenceNumber+1)%256;const l=this._buildSMPMessage(t,0,e,i,o,n);return new Promise(async(c,p)=>{this.responseResolvers[i]={resolve:c,reject:p};try{if(!this.characteristic)throw D.debug("Characteristic not available"),new Error("Characteristic not available");await this.characteristic.writeValueWithoutResponse(l)}catch(h){D.dbg(`Failed to send bluetooth characteristic message: ${h}`),delete this.responseResolvers[i],p(h)}})}async _notification(t){const e=t.target;D.debug("Notification received"),D.debug(e.value);const o=new Uint8Array(e.value.buffer);for(this.buffer=new Uint8Array([...this.buffer,...o]);this.buffer.length>=this.SMP_HEADER_SIZE;){const n=this.buffer[2]<<8|this.buffer[3],i=this.SMP_HEADER_SIZE+n;if(this.buffer.length>=i){const a=this.buffer.slice(0,i);D.debug("Processing message"),D.debug(a),await this._processMessage(a),this.buffer=this.buffer.slice(i)}else break}}async _processMessage(t){const[e,o,n,i,a,l,c,p]=t.slice(0,this.SMP_HEADER_SIZE),h=t.slice(this.SMP_HEADER_SIZE);D.debug("payload"),D.debug(h);let w;try{w=st.decode(h.buffer)}catch(b){D.error("Error decoding CBOR:",b)}const m=this.responseResolvers[c];m?(m.resolve(w),delete this.responseResolvers[c]):D.warn(`No resolver found for sequence number ${c}`)}}let C=new S("img_mgr",S.LEVEL_DEBUG);const q=(s,t)=>{if(t.major>s.major)return!0;if(t.major===s.major){if(t.minor>s.minor)return!0;if(t.minor===s.minor&&t.revision>s.revision)return!0}return!1};class Gt{constructor(t){this.IMAGE_GROUP_ID=1,this.state=0,this.mcumgr=t}async uploadImage(t,e){if(this.state===1){C.error("Upload already in progress");return}this.state=1;let o=0,n=t.byteLength;try{let i=new Uint8Array(await Nt(t));const a=this.mcumgr.maxPayloadSize;for(;o<n;){let l={off:o,data:new Uint8Array([])};o===0&&(C.debug("Starting image upload"),l.len=n,l.sha=i);let c=st.encode(l);const p=c.byteLength;C.debug(`maxPayloadSize: ${a}, initialPayloadLength: ${p}`);const h=a-p-20;if(h<=0)return C.error("MTU too small to send data"),this.state=0,!1;const w=Math.min(o+h,n),m=new Uint8Array(t.slice(o,w));l.data=m,c=st.encode(l),C.debug(`total encoded size: ${c.byteLength}`),c.byteLength>a&&C.warn(`Payload too large: ${c.byteLength} > ${a}`);const b=await this.mcumgr.sendMessage(O.WRITE,this.IMAGE_GROUP_ID,1,new Uint8Array(c));if(b.rc!==void 0&&b.rc!==T.EOK)return this.state=0,!1;o=b.off,e?.(Math.floor(o/n*100))}return this.state=0,!0}catch(i){return C.error("Error during image upload:",i),this.state=0,!1}}async getFirmwareVersion(){const t=await this.mcumgr.sendMessage(O.READ,this.IMAGE_GROUP_ID,0);if(t.images===void 0||t.images.length===0)throw new Error("No image state found");const e=t.images.find(n=>n.active);if(!e)throw new Error("Device does not use Image Manager");const o=e.version.split(".").map(Number);return{versionString:e.version,major:o[0],minor:o[1],revision:o[2]}}}function zt(s){const t=s.split(`
`),e={release:null,dev:null,versions:[]};let o=null,n=!1;return t.forEach(i=>{if(i=i.trim(),i.startsWith("#")){const a=i.match(/# (\d+)\.(\d+)\.(\d+)(?:\[(.*?)\])?\s*(.*?)\s*((?:-\w+\s*)*)$/);if(a){const l=parseInt(a[1],10),c=parseInt(a[2],10),p=parseInt(a[3],10),h={versionString:`${l}.${c}.${p}`,major:l,minor:c,revision:p},w=a[4]?a[4].trim():null,m=a[5].trim(),A=a[6].trim().split(/\s+/).filter(Boolean),$=A.includes("-obsolete"),x=A.includes("-dev");$||((!e.dev||q(e.dev,h))&&(e.dev=h),x||(!e.release||q(e.release,h))&&(e.release=h)),n=p===0,o={version:h,isObsolete:$,isDev:x,highlight:m||null,date:w,summary:null,changes:[]},e.versions.push(o)}}else if(i.startsWith("-")){const a=i.substring(1).trim();o&&(o.changes.push(a),n=!1)}else i!==""&&o&&n&&o.version.revision===0&&(o.summary?o.summary+=`
`:o.summary="",o.summary+=i)}),e}const k=10,X=15;class V{constructor(){this.data=[]}push8(t){if(t<0||t>255)throw new RangeError(`Value ${t} is out of range for an 8-bit unsigned integer`);this.data.push(t&255)}push16(t){if(t<0||t>65535)throw new RangeError(`Value ${t} is out of range for a 16-bit unsigned integer`);this.data.push(t&255),this.data.push(t>>8&255)}push32(t){if(t<0||t>4294967295)throw new RangeError(`Value ${t} is out of range for a 32-bit unsigned integer`);this.data.push(t&255),this.data.push(t>>8&255),this.data.push(t>>16&255),this.data.push(t>>24&255)}pop8(){if(this.data.length<1)throw new RangeError("Attempted to pop from an empty array");return this.data.shift()}pop16(){if(this.data.length<2)throw new RangeError("Not enough data to pop 16 bits");const t=this.data.shift(),e=this.data.shift();return t|e<<8}pop32(){if(this.data.length<4)throw new RangeError("Not enough data to pop 32 bits");const t=this.data.shift(),e=this.data.shift(),o=this.data.shift(),n=this.data.shift();return(t|e<<8|o<<16|n<<24)>>>0}add(t){this.data.push(...t.data)}static from(t){const e=new V;return e.data=Array.from(t),e}}function Wt(s){let t=new V;t.push32(s.reserved0),t.push32(s.reserved1),t.push32(s.reserved2),t.push32(s.reserved3);for(let n=0;n<k;n++)t.push16(s.pages[n].id);let e=new V,o=new V;for(let n=0;n<k;n++){let i=s.pages[n];for(let a=0;a<X;a++){let l=i.loops[a];if(l==null){e.push16(65535);continue}e.push16(o.data.length),o.push8(l.length_beats),o.push8(l.events.length);for(const c of l.events){const[p,h]=c;o.push8(h.note&127);const w=h.state<<7|h.velocity&127;o.push8(w),o.push16(p)}}}return t.add(e),t.add(o),Uint8Array.from(t.data)}function Ft(s){let t=V.from(s),e={reserved0:t.pop32(),reserved1:t.pop32(),reserved2:t.pop32(),reserved3:t.pop32(),pages:[]};for(let n=0;n<k;n++)e.pages.push({id:t.pop16(),loops:[]});let o=[];for(let n=0;n<k*X;n++)o.push(t.pop16()!==65535);for(let n=0;n<k;n++){let i=e.pages[n];for(let a=0;a<X;a++){if(o[n*k+a]==!1){i.loops.push(null);continue}let l={length_beats:t.pop8(),events:[]},c=t.pop8();for(let p=0;p<c;p++){let h=t.pop8()&127,w=t.pop8(),m=w>>7&1,b=w&127,A=t.pop16();l.events.push([A,{note:h,state:m,velocity:b}])}i.loops.push(l)}}return e}function jt(s){let t=0;return s.loops.forEach(e=>{e!=null&&(t+=1,t+=1,e?.events?.forEach(o=>{t+=4}))}),t}function qt(s){let t=0;return s.pages.forEach(e=>t+=jt(e)),t}function Xt(){return{id:57005,loops:[{length_beats:4,events:[[0,{note:36,state:1,velocity:99}],[0,{note:42,state:1,velocity:99}],[4,{note:42,state:0,velocity:99}],[12,{note:36,state:0,velocity:99}],[12,{note:42,state:1,velocity:99}],[16,{note:42,state:0,velocity:99}],[24,{note:42,state:1,velocity:99}],[24,{note:38,state:1,velocity:99}],[28,{note:42,state:0,velocity:99}],[28,{note:38,state:0,velocity:99}],[36,{note:42,state:1,velocity:99}],[40,{note:42,state:0,velocity:99}],[42,{note:36,state:1,velocity:99}],[46,{note:36,state:0,velocity:99}],[48,{note:42,state:1,velocity:99}],[52,{note:42,state:0,velocity:99}],[54,{note:36,state:1,velocity:99}],[58,{note:36,state:0,velocity:99}],[60,{note:36,state:1,velocity:99}],[60,{note:42,state:1,velocity:99}],[64,{note:42,state:0,velocity:99}],[72,{note:36,state:0,velocity:99}],[72,{note:38,state:1,velocity:99}],[72,{note:42,state:1,velocity:99}],[76,{note:42,state:0,velocity:99}],[84,{note:38,state:0,velocity:99}],[84,{note:42,state:1,velocity:99}],[88,{note:42,state:0,velocity:99}],[90,{note:46,state:1,velocity:99}],[94,{note:46,state:0,velocity:99}]]},{length_beats:4,events:[[0,{note:36,state:1,velocity:122}],[0,{note:42,state:1,velocity:114}],[6,{note:42,state:0,velocity:114}],[12,{note:36,state:0,velocity:122}],[12,{note:37,state:1,velocity:126}],[12,{note:42,state:1,velocity:100}],[18,{note:37,state:0,velocity:126}],[18,{note:42,state:0,velocity:100}],[18,{note:36,state:1,velocity:122}],[19,{note:36,state:0,velocity:122}],[24,{note:36,state:1,velocity:122}],[24,{note:42,state:1,velocity:114}],[25,{note:42,state:0,velocity:114}],[30,{note:37,state:1,velocity:114}],[36,{note:36,state:0,velocity:122}],[36,{note:37,state:0,velocity:114}],[36,{note:42,state:1,velocity:85}],[37,{note:42,state:0,velocity:85}],[42,{note:36,state:1,velocity:126}],[43,{note:36,state:0,velocity:126}],[48,{note:36,state:1,velocity:122}],[48,{note:37,state:1,velocity:126}],[48,{note:42,state:1,velocity:126}],[54,{note:37,state:0,velocity:126}],[54,{note:42,state:0,velocity:126}],[60,{note:36,state:0,velocity:122}],[60,{note:42,state:1,velocity:50}],[61,{note:42,state:0,velocity:50}],[66,{note:37,state:1,velocity:126}],[66,{note:36,state:1,velocity:126}],[72,{note:37,state:0,velocity:126}],[72,{note:36,state:0,velocity:126}],[72,{note:42,state:1,velocity:126}],[72,{note:36,state:1,velocity:126}],[78,{note:42,state:0,velocity:126}],[84,{note:36,state:0,velocity:126}],[84,{note:42,state:1,velocity:77}],[84,{note:37,state:1,velocity:126}],[85,{note:42,state:0,velocity:77}],[90,{note:37,state:0,velocity:126}],[90,{note:46,state:1,velocity:114}],[90,{note:36,state:1,velocity:126}],[91,{note:46,state:0,velocity:114}],[91,{note:36,state:0,velocity:126}]]},{length_beats:4,events:[[0,{note:42,state:1,velocity:85}],[0,{note:36,state:1,velocity:99}],[0,{note:55,state:1,velocity:97}],[6,{note:42,state:0,velocity:85}],[6,{note:36,state:0,velocity:99}],[6,{note:55,state:0,velocity:97}],[6,{note:36,state:1,velocity:56}],[12,{note:36,state:0,velocity:56}],[12,{note:42,state:1,velocity:25}],[18,{note:42,state:0,velocity:25}],[18,{note:36,state:1,velocity:109}],[24,{note:36,state:0,velocity:109}],[24,{note:38,state:1,velocity:104}],[24,{note:42,state:1,velocity:67}],[25,{note:38,state:0,velocity:104}],[30,{note:42,state:0,velocity:67}],[30,{note:38,state:1,velocity:74}],[31,{note:38,state:0,velocity:74}],[36,{note:42,state:1,velocity:67}],[42,{note:42,state:0,velocity:67}],[42,{note:38,state:1,velocity:53}],[48,{note:38,state:0,velocity:53}],[48,{note:42,state:1,velocity:85}],[54,{note:42,state:0,velocity:85}],[54,{note:38,state:1,velocity:31}],[60,{note:38,state:0,velocity:31}],[60,{note:42,state:1,velocity:85}],[60,{note:36,state:1,velocity:98}],[66,{note:36,state:0,velocity:98}],[66,{note:42,state:0,velocity:85}],[72,{note:42,state:1,velocity:77}],[78,{note:42,state:0,velocity:77}],[78,{note:38,state:1,velocity:94}],[84,{note:38,state:0,velocity:94}],[84,{note:42,state:1,velocity:77}],[90,{note:42,state:0,velocity:77}],[90,{note:38,state:1,velocity:94}],[96,{note:38,state:0,velocity:94}]]},{length_beats:4,events:[[0,{note:36,state:1,velocity:122}],[0,{note:42,state:1,velocity:114}],[4,{note:36,state:0,velocity:122}],[4,{note:42,state:0,velocity:114}],[8,{note:42,state:1,velocity:62}],[12,{note:42,state:0,velocity:62}],[16,{note:42,state:1,velocity:89}],[17,{note:42,state:0,velocity:89}],[24,{note:42,state:1,velocity:114}],[24,{note:38,state:1,velocity:114}],[28,{note:42,state:0,velocity:114}],[28,{note:38,state:0,velocity:114}],[32,{note:42,state:1,velocity:77}],[36,{note:42,state:0,velocity:77}],[40,{note:42,state:1,velocity:107}],[44,{note:42,state:0,velocity:107}],[48,{note:42,state:1,velocity:114}],[48,{note:36,state:1,velocity:126}],[52,{note:42,state:0,velocity:114}],[52,{note:36,state:0,velocity:126}],[56,{note:42,state:1,velocity:85}],[60,{note:42,state:0,velocity:85}],[64,{note:42,state:1,velocity:100}],[65,{note:42,state:0,velocity:100}],[72,{note:42,state:1,velocity:114}],[72,{note:38,state:1,velocity:122}],[76,{note:42,state:0,velocity:114}],[76,{note:38,state:0,velocity:122}],[80,{note:42,state:1,velocity:95}],[81,{note:42,state:0,velocity:95}],[88,{note:42,state:1,velocity:107}],[88,{note:36,state:1,velocity:109}],[89,{note:42,state:0,velocity:107}],[89,{note:36,state:0,velocity:109}]]},{length_beats:4,events:[[0,{note:36,state:1,velocity:114}],[0,{note:42,state:1,velocity:95}],[4,{note:36,state:0,velocity:114}],[4,{note:42,state:0,velocity:95}],[12,{note:42,state:1,velocity:90}],[12,{note:36,state:1,velocity:110}],[16,{note:42,state:0,velocity:90}],[16,{note:36,state:0,velocity:110}],[24,{note:37,state:1,velocity:73}],[24,{note:42,state:1,velocity:95}],[28,{note:37,state:0,velocity:73}],[28,{note:42,state:0,velocity:95}],[36,{note:42,state:1,velocity:70}],[40,{note:42,state:0,velocity:70}],[48,{note:36,state:1,velocity:116}],[48,{note:42,state:1,velocity:87}],[52,{note:36,state:0,velocity:116}],[52,{note:42,state:0,velocity:87}],[60,{note:36,state:1,velocity:114}],[60,{note:42,state:1,velocity:88}],[64,{note:36,state:0,velocity:114}],[64,{note:42,state:0,velocity:88}],[72,{note:37,state:1,velocity:69}],[72,{note:42,state:1,velocity:73}],[76,{note:37,state:0,velocity:69}],[76,{note:42,state:0,velocity:73}],[84,{note:46,state:1,velocity:91}],[88,{note:46,state:0,velocity:91}]]},{length_beats:4,events:[[0,{note:42,state:1,velocity:88}],[0,{note:36,state:1,velocity:88}],[2,{note:42,state:0,velocity:88}],[2,{note:36,state:0,velocity:88}],[12,{note:46,state:1,velocity:67}],[14,{note:46,state:0,velocity:67}],[24,{note:42,state:1,velocity:80}],[24,{note:37,state:1,velocity:115}],[26,{note:42,state:0,velocity:80}],[26,{note:37,state:0,velocity:115}],[36,{note:42,state:1,velocity:77}],[36,{note:36,state:1,velocity:47}],[38,{note:42,state:0,velocity:77}],[38,{note:36,state:0,velocity:47}],[48,{note:46,state:1,velocity:79}],[48,{note:36,state:1,velocity:87}],[50,{note:46,state:0,velocity:79}],[50,{note:36,state:0,velocity:87}],[60,{note:42,state:1,velocity:70}],[62,{note:42,state:0,velocity:70}],[72,{note:42,state:1,velocity:67}],[72,{note:37,state:1,velocity:113}],[74,{note:42,state:0,velocity:67}],[74,{note:37,state:0,velocity:113}],[84,{note:42,state:1,velocity:79}],[84,{note:36,state:1,velocity:48}],[86,{note:42,state:0,velocity:79}],[86,{note:36,state:0,velocity:48}]]},{length_beats:4,events:[[0,{note:46,state:1,velocity:84}],[0,{note:36,state:1,velocity:108}],[0,{note:37,state:1,velocity:107}],[4,{note:46,state:0,velocity:84}],[4,{note:36,state:0,velocity:108}],[4,{note:37,state:0,velocity:107}],[8,{note:42,state:1,velocity:92}],[12,{note:42,state:0,velocity:92}],[16,{note:37,state:1,velocity:84}],[20,{note:37,state:0,velocity:84}],[24,{note:38,state:1,velocity:108}],[24,{note:37,state:1,velocity:90}],[24,{note:42,state:1,velocity:93}],[28,{note:38,state:0,velocity:108}],[28,{note:37,state:0,velocity:90}],[28,{note:42,state:0,velocity:93}],[40,{note:37,state:1,velocity:89}],[44,{note:37,state:0,velocity:89}],[48,{note:42,state:1,velocity:81}],[48,{note:36,state:1,velocity:105}],[48,{note:37,state:1,velocity:79}],[52,{note:42,state:0,velocity:81}],[52,{note:36,state:0,velocity:105}],[52,{note:37,state:0,velocity:79}],[64,{note:37,state:1,velocity:84}],[68,{note:37,state:0,velocity:84}],[72,{note:38,state:1,velocity:109}],[72,{note:37,state:1,velocity:85}],[72,{note:42,state:1,velocity:88}],[76,{note:38,state:0,velocity:109}],[76,{note:37,state:0,velocity:85}],[76,{note:42,state:0,velocity:88}],[88,{note:37,state:1,velocity:87}],[92,{note:37,state:0,velocity:87}]]},{length_beats:4,events:[[0,{note:44,state:1,velocity:93}],[0,{note:36,state:1,velocity:116}],[3,{note:44,state:0,velocity:64}],[3,{note:36,state:0,velocity:64}],[6,{note:44,state:1,velocity:93}],[9,{note:44,state:0,velocity:64}],[12,{note:46,state:1,velocity:94}],[15,{note:46,state:0,velocity:64}],[24,{note:40,state:1,velocity:118}],[24,{note:44,state:1,velocity:88}],[24,{note:36,state:1,velocity:116}],[27,{note:40,state:0,velocity:64}],[27,{note:44,state:0,velocity:64}],[27,{note:36,state:0,velocity:64}],[36,{note:46,state:1,velocity:96}],[39,{note:46,state:0,velocity:64}],[48,{note:44,state:1,velocity:94}],[48,{note:36,state:1,velocity:116}],[51,{note:44,state:0,velocity:64}],[51,{note:36,state:0,velocity:64}],[54,{note:44,state:1,velocity:89}],[57,{note:44,state:0,velocity:64}],[60,{note:46,state:1,velocity:93}],[63,{note:46,state:0,velocity:64}],[72,{note:44,state:1,velocity:98}],[72,{note:40,state:1,velocity:118}],[72,{note:36,state:1,velocity:116}],[75,{note:44,state:0,velocity:64}],[75,{note:40,state:0,velocity:64}],[75,{note:36,state:0,velocity:64}],[84,{note:46,state:1,velocity:92}],[87,{note:46,state:0,velocity:64}]]},{length_beats:4,events:[[0,{note:42,state:1,velocity:114}],[0,{note:36,state:1,velocity:114}],[6,{note:42,state:0,velocity:114}],[6,{note:36,state:0,velocity:114}],[12,{note:42,state:1,velocity:100}],[12,{note:36,state:1,velocity:104}],[18,{note:42,state:0,velocity:100}],[18,{note:36,state:0,velocity:104}],[24,{note:42,state:1,velocity:114}],[24,{note:38,state:1,velocity:126}],[30,{note:42,state:0,velocity:114}],[30,{note:38,state:0,velocity:126}],[36,{note:42,state:1,velocity:73}],[37,{note:42,state:0,velocity:73}],[42,{note:38,state:1,velocity:99}],[48,{note:38,state:0,velocity:99}],[48,{note:36,state:1,velocity:122}],[48,{note:42,state:1,velocity:107}],[54,{note:36,state:0,velocity:122}],[60,{note:42,state:0,velocity:107}],[60,{note:42,state:1,velocity:100}],[60,{note:36,state:1,velocity:109}],[66,{note:42,state:0,velocity:100}],[66,{note:36,state:0,velocity:109}],[66,{note:37,state:0,velocity:0}],[66,{note:37,state:0,velocity:0}],[67,{note:37,state:1,velocity:5}],[67,{note:37,state:0,velocity:5}],[68,{note:37,state:1,velocity:10}],[68,{note:37,state:0,velocity:10}],[68,{note:37,state:1,velocity:15}],[69,{note:37,state:0,velocity:15}],[69,{note:37,state:1,velocity:20}],[70,{note:37,state:0,velocity:20}],[70,{note:37,state:1,velocity:26}],[70,{note:37,state:0,velocity:26}],[70,{note:37,state:1,velocity:31}],[71,{note:37,state:0,velocity:31}],[71,{note:37,state:1,velocity:36}],[72,{note:37,state:0,velocity:36}],[72,{note:37,state:1,velocity:41}],[72,{note:37,state:0,velocity:41}],[73,{note:37,state:1,velocity:46}],[73,{note:37,state:0,velocity:46}],[74,{note:37,state:1,velocity:52}],[74,{note:37,state:0,velocity:52}],[74,{note:37,state:1,velocity:57}],[75,{note:37,state:0,velocity:57}],[75,{note:37,state:1,velocity:61}],[76,{note:37,state:0,velocity:61}],[76,{note:37,state:1,velocity:66}],[76,{note:37,state:0,velocity:66}],[76,{note:37,state:1,velocity:71}],[77,{note:37,state:0,velocity:71}],[77,{note:37,state:1,velocity:77}],[78,{note:37,state:0,velocity:77}],[78,{note:37,state:1,velocity:82}],[78,{note:37,state:0,velocity:82}],[79,{note:37,state:1,velocity:87}],[79,{note:37,state:0,velocity:87}],[80,{note:37,state:1,velocity:92}],[80,{note:37,state:0,velocity:92}],[80,{note:37,state:1,velocity:97}],[81,{note:37,state:0,velocity:97}],[81,{note:37,state:1,velocity:103}],[82,{note:37,state:0,velocity:103}],[82,{note:37,state:1,velocity:108}],[82,{note:37,state:0,velocity:108}],[82,{note:37,state:1,velocity:113}],[83,{note:37,state:0,velocity:113}],[83,{note:37,state:1,velocity:118}],[84,{note:37,state:0,velocity:118}],[84,{note:38,state:1,velocity:111}],[85,{note:38,state:0,velocity:111}],[86,{note:38,state:1,velocity:118}],[87,{note:38,state:0,velocity:118}],[87,{note:38,state:1,velocity:107}],[88,{note:38,state:0,velocity:107}],[88,{note:38,state:1,velocity:96}],[90,{note:38,state:0,velocity:96}],[90,{note:38,state:1,velocity:85}],[91,{note:38,state:0,velocity:85}],[92,{note:38,state:1,velocity:75}],[93,{note:38,state:0,velocity:75}],[93,{note:38,state:1,velocity:64}],[94,{note:38,state:0,velocity:64}],[94,{note:38,state:1,velocity:54}],[96,{note:38,state:0,velocity:54}]]},{length_beats:4,events:[[0,{note:51,state:1,velocity:95}],[6,{note:51,state:0,velocity:95}],[12,{note:51,state:1,velocity:100}],[13,{note:51,state:0,velocity:100}],[24,{note:38,state:1,velocity:126}],[24,{note:51,state:1,velocity:126}],[30,{note:38,state:0,velocity:126}],[30,{note:51,state:0,velocity:126}],[36,{note:51,state:1,velocity:89}],[37,{note:51,state:0,velocity:89}],[42,{note:51,state:1,velocity:114}],[43,{note:51,state:0,velocity:114}],[48,{note:51,state:1,velocity:126}],[54,{note:51,state:0,velocity:126}],[60,{note:45,state:1,velocity:126}],[60,{note:51,state:1,velocity:126}],[66,{note:45,state:0,velocity:126}],[66,{note:51,state:0,velocity:126}],[72,{note:51,state:1,velocity:100}],[73,{note:51,state:0,velocity:100}],[84,{note:51,state:1,velocity:107}],[84,{note:45,state:1,velocity:126}],[90,{note:51,state:0,velocity:107}],[90,{note:45,state:0,velocity:126}]]},{length_beats:4,events:[[0,{note:36,state:1,velocity:99}],[0,{note:42,state:1,velocity:99}],[4,{note:36,state:0,velocity:99}],[4,{note:42,state:0,velocity:99}],[8,{note:42,state:1,velocity:61}],[12,{note:42,state:0,velocity:61}],[12,{note:42,state:1,velocity:99}],[12,{note:46,state:1,velocity:62}],[16,{note:42,state:0,velocity:99}],[16,{note:46,state:0,velocity:62}],[20,{note:42,state:1,velocity:61}],[24,{note:42,state:0,velocity:61}],[24,{note:42,state:1,velocity:99}],[24,{note:40,state:1,velocity:99}],[24,{note:38,state:1,velocity:77}],[28,{note:42,state:0,velocity:99}],[28,{note:40,state:0,velocity:99}],[28,{note:38,state:0,velocity:77}],[32,{note:42,state:1,velocity:61}],[36,{note:42,state:0,velocity:61}],[36,{note:37,state:1,velocity:77}],[36,{note:42,state:1,velocity:99}],[36,{note:46,state:1,velocity:62}],[40,{note:37,state:0,velocity:77}],[40,{note:42,state:0,velocity:99}],[40,{note:46,state:0,velocity:62}],[44,{note:37,state:1,velocity:48}],[44,{note:42,state:1,velocity:61}],[48,{note:37,state:0,velocity:48}],[48,{note:42,state:0,velocity:61}],[48,{note:42,state:1,velocity:99}],[48,{note:36,state:1,velocity:99}],[52,{note:42,state:0,velocity:99}],[52,{note:36,state:0,velocity:99}],[56,{note:37,state:1,velocity:62}],[56,{note:42,state:1,velocity:61}],[60,{note:37,state:0,velocity:62}],[60,{note:42,state:0,velocity:61}],[60,{note:37,state:1,velocity:77}],[60,{note:42,state:1,velocity:99}],[60,{note:46,state:1,velocity:62}],[64,{note:46,state:0,velocity:62}],[64,{note:37,state:0,velocity:77}],[64,{note:42,state:0,velocity:99}],[68,{note:38,state:1,velocity:77}],[68,{note:40,state:1,velocity:99}],[68,{note:42,state:1,velocity:61}],[68,{note:46,state:1,velocity:62}],[72,{note:38,state:0,velocity:77}],[72,{note:40,state:0,velocity:99}],[72,{note:42,state:0,velocity:61}],[72,{note:46,state:0,velocity:62}],[72,{note:42,state:1,velocity:99}],[76,{note:42,state:0,velocity:99}],[80,{note:42,state:1,velocity:61}],[84,{note:42,state:0,velocity:61}],[84,{note:42,state:1,velocity:99}],[88,{note:42,state:0,velocity:99}],[92,{note:42,state:1,velocity:61}],[92,{note:36,state:1,velocity:77}],[96,{note:42,state:0,velocity:61}],[96,{note:36,state:0,velocity:77}]]},{length_beats:4,events:[[0,{note:42,state:1,velocity:95}],[0,{note:36,state:1,velocity:95}],[4,{note:42,state:0,velocity:95}],[4,{note:36,state:0,velocity:95}],[6,{note:42,state:1,velocity:60}],[10,{note:42,state:0,velocity:60}],[12,{note:42,state:1,velocity:95}],[12,{note:46,state:1,velocity:64}],[15,{note:46,state:0,velocity:64}],[16,{note:42,state:0,velocity:95}],[18,{note:42,state:1,velocity:60}],[22,{note:42,state:0,velocity:60}],[24,{note:37,state:1,velocity:95}],[24,{note:40,state:1,velocity:94}],[27,{note:40,state:0,velocity:94}],[28,{note:37,state:0,velocity:95}],[30,{note:47,state:1,velocity:67}],[34,{note:47,state:0,velocity:67}],[36,{note:46,state:1,velocity:66}],[39,{note:46,state:0,velocity:66}],[42,{note:37,state:1,velocity:95}],[42,{note:40,state:1,velocity:94}],[45,{note:40,state:0,velocity:94}],[46,{note:37,state:0,velocity:95}],[48,{note:36,state:1,velocity:95}],[48,{note:42,state:1,velocity:66}],[48,{note:42,state:1,velocity:66}],[52,{note:36,state:0,velocity:95}],[52,{note:42,state:0,velocity:66}],[52,{note:42,state:0,velocity:66}],[56,{note:36,state:1,velocity:95}],[56,{note:42,state:1,velocity:65}],[56,{note:42,state:1,velocity:65}],[60,{note:36,state:0,velocity:95}],[60,{note:42,state:0,velocity:65}],[60,{note:42,state:0,velocity:65}],[64,{note:36,state:1,velocity:95}],[64,{note:42,state:1,velocity:61}],[68,{note:36,state:0,velocity:95}],[68,{note:42,state:0,velocity:61}],[72,{note:42,state:1,velocity:95}],[72,{note:37,state:1,velocity:95}],[72,{note:45,state:1,velocity:67}],[72,{note:40,state:1,velocity:95}],[75,{note:40,state:0,velocity:95}],[76,{note:42,state:0,velocity:95}],[76,{note:37,state:0,velocity:95}],[76,{note:45,state:0,velocity:67}],[78,{note:42,state:1,velocity:60}],[82,{note:42,state:0,velocity:60}],[84,{note:42,state:1,velocity:95}],[84,{note:47,state:1,velocity:67}],[84,{note:46,state:1,velocity:67}],[87,{note:46,state:0,velocity:67}],[88,{note:42,state:0,velocity:95}],[88,{note:47,state:0,velocity:67}],[90,{note:42,state:1,velocity:60}],[90,{note:36,state:1,velocity:95}],[91,{note:42,state:0,velocity:60}],[93,{note:36,state:0,velocity:95}],[93,{note:42,state:1,velocity:59}],[94,{note:42,state:0,velocity:59}]]},{length_beats:4,events:[[0,{note:42,state:1,velocity:114}],[0,{note:36,state:1,velocity:126}],[6,{note:42,state:0,velocity:114}],[6,{note:36,state:0,velocity:126}],[6,{note:42,state:1,velocity:95}],[7,{note:42,state:0,velocity:95}],[12,{note:42,state:1,velocity:58}],[13,{note:42,state:0,velocity:58}],[18,{note:42,state:1,velocity:107}],[18,{note:40,state:1,velocity:122}],[19,{note:42,state:0,velocity:107}],[19,{note:40,state:0,velocity:122}],[24,{note:42,state:1,velocity:126}],[24,{note:36,state:1,velocity:109}],[25,{note:36,state:0,velocity:109}],[30,{note:42,state:0,velocity:126}],[30,{note:42,state:1,velocity:85}],[31,{note:42,state:0,velocity:85}],[36,{note:42,state:1,velocity:27}],[36,{note:40,state:1,velocity:122}],[37,{note:42,state:0,velocity:27}],[42,{note:40,state:0,velocity:122}],[42,{note:42,state:1,velocity:114}],[43,{note:42,state:0,velocity:114}],[48,{note:42,state:1,velocity:126}],[48,{note:36,state:1,velocity:126}],[54,{note:42,state:0,velocity:126}],[54,{note:36,state:0,velocity:126}],[60,{note:42,state:1,velocity:70}],[61,{note:42,state:0,velocity:70}],[66,{note:42,state:1,velocity:107}],[66,{note:40,state:1,velocity:114}],[67,{note:42,state:0,velocity:107}],[72,{note:40,state:0,velocity:114}],[72,{note:42,state:1,velocity:126}],[72,{note:36,state:1,velocity:114}],[78,{note:42,state:0,velocity:126}],[78,{note:36,state:0,velocity:114}],[78,{note:42,state:1,velocity:73}],[79,{note:42,state:0,velocity:73}],[84,{note:42,state:1,velocity:40}],[84,{note:40,state:1,velocity:99}],[85,{note:42,state:0,velocity:40}],[90,{note:40,state:0,velocity:99}],[90,{note:42,state:1,velocity:107}],[90,{note:38,state:1,velocity:114}],[91,{note:42,state:0,velocity:107}],[96,{note:38,state:0,velocity:114}]]},{length_beats:4,events:[[0,{note:51,state:1,velocity:114}],[0,{note:36,state:1,velocity:126}],[0,{note:38,state:1,velocity:90}],[1,{note:51,state:0,velocity:114}],[1,{note:38,state:0,velocity:90}],[6,{note:36,state:0,velocity:126}],[6,{note:51,state:1,velocity:89}],[7,{note:51,state:0,velocity:89}],[12,{note:51,state:1,velocity:89}],[13,{note:51,state:0,velocity:89}],[18,{note:51,state:1,velocity:100}],[18,{note:40,state:1,velocity:122}],[19,{note:51,state:0,velocity:100}],[24,{note:40,state:0,velocity:122}],[24,{note:51,state:1,velocity:100}],[25,{note:51,state:0,velocity:100}],[30,{note:51,state:1,velocity:100}],[31,{note:51,state:0,velocity:100}],[36,{note:51,state:1,velocity:114}],[36,{note:40,state:1,velocity:122}],[37,{note:51,state:0,velocity:114}],[42,{note:40,state:0,velocity:122}],[42,{note:51,state:1,velocity:114}],[42,{note:51,state:1,velocity:100}],[43,{note:51,state:0,velocity:114}],[48,{note:51,state:0,velocity:100}],[48,{note:51,state:1,velocity:95}],[48,{note:36,state:1,velocity:126}],[48,{note:38,state:1,velocity:114}],[54,{note:51,state:0,velocity:95}],[54,{note:36,state:0,velocity:126}],[54,{note:38,state:0,velocity:114}],[60,{note:51,state:1,velocity:114}],[60,{note:51,state:1,velocity:89}],[61,{note:51,state:0,velocity:114}],[66,{note:51,state:0,velocity:89}],[66,{note:40,state:1,velocity:126}],[72,{note:40,state:0,velocity:126}],[72,{note:51,state:1,velocity:126}],[72,{note:51,state:1,velocity:89}],[73,{note:51,state:0,velocity:126}],[78,{note:51,state:0,velocity:89}],[84,{note:51,state:1,velocity:95}],[84,{note:45,state:1,velocity:122}],[85,{note:51,state:0,velocity:95}],[90,{note:45,state:0,velocity:122}],[90,{note:51,state:1,velocity:114}],[90,{note:45,state:1,velocity:109}],[91,{note:51,state:0,velocity:114}],[96,{note:45,state:0,velocity:109}]]},{length_beats:4,events:[[0,{note:43,state:1,velocity:44}],[0,{note:36,state:1,velocity:123}],[0,{note:51,state:1,velocity:98}],[6,{note:43,state:0,velocity:44}],[6,{note:36,state:0,velocity:123}],[6,{note:51,state:0,velocity:98}],[12,{note:43,state:1,velocity:38}],[18,{note:43,state:0,velocity:38}],[24,{note:43,state:1,velocity:80}],[24,{note:40,state:1,velocity:115}],[24,{note:51,state:1,velocity:98}],[28,{note:43,state:0,velocity:80}],[28,{note:40,state:0,velocity:115}],[30,{note:51,state:0,velocity:98}],[36,{note:36,state:1,velocity:72}],[36,{note:43,state:1,velocity:41}],[39,{note:47,state:1,velocity:17}],[42,{note:36,state:0,velocity:72}],[42,{note:43,state:0,velocity:41}],[45,{note:47,state:0,velocity:17}],[48,{note:43,state:1,velocity:83}],[48,{note:36,state:1,velocity:99}],[48,{note:51,state:1,velocity:97}],[54,{note:43,state:0,velocity:83}],[54,{note:36,state:0,velocity:99}],[54,{note:51,state:0,velocity:97}],[60,{note:43,state:1,velocity:43}],[60,{note:36,state:1,velocity:103}],[64,{note:43,state:0,velocity:43}],[64,{note:36,state:0,velocity:103}],[72,{note:40,state:1,velocity:105}],[72,{note:47,state:1,velocity:89}],[72,{note:43,state:1,velocity:62}],[72,{note:51,state:1,velocity:95}],[76,{note:40,state:0,velocity:105}],[76,{note:47,state:0,velocity:89}],[78,{note:43,state:0,velocity:62}],[78,{note:51,state:0,velocity:95}],[84,{note:43,state:1,velocity:41}],[84,{note:36,state:1,velocity:82}],[88,{note:43,state:0,velocity:41}],[88,{note:36,state:0,velocity:82}]]}]}}function Kt(){return{id:48879,loops:[{length_beats:2,events:[[0,{note:42,state:1,velocity:59}],[0,{note:36,state:1,velocity:81}],[12,{note:42,state:0,velocity:64}],[12,{note:36,state:0,velocity:64}],[12,{note:42,state:1,velocity:81}],[24,{note:42,state:0,velocity:64}],[24,{note:42,state:1,velocity:59}],[24,{note:38,state:1,velocity:81}],[24,{note:36,state:1,velocity:81}],[36,{note:42,state:0,velocity:64}],[36,{note:38,state:0,velocity:64}],[36,{note:36,state:0,velocity:64}],[36,{note:42,state:1,velocity:81}],[48,{note:42,state:0,velocity:64}]]},{length_beats:4,events:[[0,{note:42,state:1,velocity:81}],[0,{note:36,state:1,velocity:81}],[12,{note:42,state:0,velocity:64}],[12,{note:36,state:0,velocity:64}],[12,{note:42,state:1,velocity:81}],[12,{note:36,state:1,velocity:81}],[24,{note:42,state:0,velocity:64}],[24,{note:36,state:0,velocity:64}],[24,{note:42,state:1,velocity:81}],[24,{note:38,state:1,velocity:81}],[36,{note:42,state:0,velocity:64}],[36,{note:38,state:0,velocity:64}],[36,{note:42,state:1,velocity:81}],[36,{note:38,state:1,velocity:81}],[48,{note:42,state:0,velocity:64}],[48,{note:38,state:0,velocity:64}],[48,{note:42,state:1,velocity:81}],[48,{note:36,state:1,velocity:81}],[60,{note:42,state:0,velocity:64}],[60,{note:36,state:0,velocity:64}],[60,{note:42,state:1,velocity:81}],[72,{note:42,state:0,velocity:64}],[72,{note:42,state:1,velocity:81}],[72,{note:38,state:1,velocity:81}],[84,{note:42,state:0,velocity:64}],[84,{note:38,state:0,velocity:64}],[84,{note:42,state:1,velocity:81}],[96,{note:42,state:0,velocity:64}]]}]}}function St(){const s=[];for(;s.length<10;){const e={id:65535,loops:new Array(X).fill(null)};s.push(e)}return s[1]=Xt(),s[2]=Kt(),{reserved0:4294967295,reserved1:4294967295,reserved2:4294967295,reserved3:4294967295,pages:s}}let d=new S("smpl_mgr",S.LEVEL_DEBUG);class Zt{constructor(t){this.GROUP_ID=100,this.state=0,this.mcumgr=t}async isSet(){d.debug("Checking if any samples are set");const t=await this.mcumgr.sendMessage(O.READ,this.GROUP_ID,2);return t.rc!==void 0&&t.rc!==T.EOK?(d.error(`Error response received, rc: ${t.rc}`),Promise.reject(t.rc)):t.set}async getIDs(){d.debug("Getting sample ID");const t=await this.mcumgr.sendMessage(O.READ,this.GROUP_ID,0);if(t.rc!==void 0&&t.rc!==T.EOK)return d.error(`Error response received, rc: ${t.rc}`),Promise.reject(t.rc);const e=t;return d.debug(`Received sample IDs: ${e.ids}`),e.ids}async getSpaceUsed(){d.debug("Getting space used");const t=await this.mcumgr.sendMessage(O.READ,this.GROUP_ID,3);if(t.rc!==void 0&&t.rc!==T.EOK)return d.error(`Error response received, rc: ${t.rc}`),Promise.reject(t.rc);const e=t;return d.debug(`Received storage, total: ${e.tot}, used: ${e.usd}`),e.usd/e.tot*100}async uploadSamples(t,e){if(d.debug("Starting sample upload process"),this.state!==0)return d.error("Cant start upload when not in idle state"),Promise.reject("Cant start upload when not in idle state");this.state=1;const o=this.mcumgr.maxPayloadSize,n=Wt(t),i=n.byteLength;let a=0;for(;this.state===1&&a<i;){d.debug(`Current offset: ${a}, Total length: ${i}`);let l={off:a,data:new Uint8Array([]),len:i},c=this._payloadUploadEncode(l);d.debug(`Initial payload size (without data): ${c.byteLength} bytes`);const p=o-c.byteLength-20;if(d.debug(`Max data size for this chunk: ${p} bytes`),p<=0)return d.error("MTU too small to send data"),this.state=0,!1;const h=Math.min(a+p,i),w=new Uint8Array(n.slice(a,h));if(d.debug(`Data chunk length: ${w.byteLength} bytes (from offset ${a} to ${h})`),l.data=w,c=this._payloadUploadEncode(l),d.debug(`Payload size after adding data: ${c.byteLength} bytes`),c.byteLength>o)return d.warn(`Payload too large: ${c.byteLength} > ${o}`),this.state=0,!1;try{d.debug("Sending payload to mcumgr");const m=await this.mcumgr.sendMessage(O.WRITE,this.GROUP_ID,1,c);if(d.debug("Received response from mcumgr"),m.rc!==void 0&&m.rc!==T.EOK)return d.error(`Error response received, rc: ${m.rc}`),this.state=0,!1;const b=m;d.debug(`Response success, new offset: ${b.off}`),a=b.off;const A=Math.floor(a/i*100);if(d.debug(`Upload progress: ${A}%`),e?.(A),a>=i){d.debug("Upload complete"),this.state=0;break}}catch(m){return d.error("Error during upload:",m),this.state=0,!1}}return d.debug("Successfully uploaded samples"),!0}async downloadSamples(t){if(d.debug("Starting sample download process"),this.state!==0)return d.error("Cant start download when not in idle state"),Promise.reject("Cant start download when not in idle state");this.state=2;let e=new Uint8Array([]),o=0,n=0,i={off:o},a=this._payloadDownloadEncode(i);try{const l=await this.mcumgr.sendMessage(O.READ,this.GROUP_ID,1,a);if(l.rc!==void 0&&l.rc!==T.EOK)return d.error(`Error response received, rc: ${l.rc}`),this.state=0,null;const c=l;if(d.debug(`Received first chunk, offset: ${c.off}, data length: ${c.data.byteLength}`),c.len===void 0)return d.error("Length not received in first chunk"),this.state=0,null;if(c.off!==o)return d.error("Invalid offset received in first chunk"),this.state=0,null;e=c.data,o=c.off+c.data.byteLength,n=c.len,t?.(Math.floor(o/n*100))}catch(l){return d.error("Error during download:",l),this.state=0,null}for(;o<n;){d.debug(`Current offset: ${o}, Total length: ${n}`),i={off:o},a=this._payloadDownloadEncode(i);try{const l=await this.mcumgr.sendMessage(O.READ,this.GROUP_ID,1,a);if(l.rc!==void 0&&l.rc!==T.EOK)return d.error(`Error response received, rc: ${l.rc}`),this.state=0,null;const c=l;if(d.debug(`Received chunk, offset: ${c.off}, data length: ${c.data.byteLength}`),e=new Uint8Array([...e,...c.data]),o=c.off+c.data.byteLength,t?.(Math.floor(o/n*100)),o>=n){d.debug("Download complete"),this.state=0;break}}catch(l){return d.error("Error during download:",l),this.state=0,null}}return d.debug("Successfully downloaded samples"),Promise.resolve(Ft(e))}_payloadUploadEncode(t){d.debug(`Encoding payload: len=${t.len}, off=${t.off}, data=${t.data.byteLength} bytes`);const e=t.len&255,o=t.len>>8&255,n=t.len>>16&255,i=t.len>>24&255,a=t.off&255,l=t.off>>8&255,c=t.off>>16&255,p=t.off>>24&255;return new Uint8Array([e,o,n,i,a,l,c,p,...t.data])}_payloadDownloadEncode(t){d.debug(`Encoding payload: off=${t.off}`);const e=t.off&255,o=t.off>>8&255,n=t.off>>16&255,i=t.off>>24&255;return new Uint8Array([e,o,n,i])}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const F=globalThis,at=F.ShadowRoot&&(F.ShadyCSS===void 0||F.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,At=Symbol(),ut=new WeakMap;let Yt=class{constructor(t,e,o){if(this._$cssResult$=!0,o!==At)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(at&&t===void 0){const o=e!==void 0&&e.length===1;o&&(t=ut.get(e)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),o&&ut.set(e,t))}return t}toString(){return this.cssText}};const Qt=s=>new Yt(typeof s=="string"?s:s+"",void 0,At),Jt=(s,t)=>{if(at)s.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const e of t){const o=document.createElement("style"),n=F.litNonce;n!==void 0&&o.setAttribute("nonce",n),o.textContent=e.cssText,s.appendChild(o)}},ft=at?s=>s:s=>s instanceof CSSStyleSheet?(t=>{let e="";for(const o of t.cssRules)e+=o.cssText;return Qt(e)})(s):s;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:te,defineProperty:ee,getOwnPropertyDescriptor:oe,getOwnPropertyNames:se,getOwnPropertySymbols:ne,getPrototypeOf:ie}=Object,Y=globalThis,pt=Y.trustedTypes,ae=pt?pt.emptyScript:"",ce=Y.reactiveElementPolyfillSupport,H=(s,t)=>s,nt={toAttribute(s,t){switch(t){case Boolean:s=s?ae:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,t){let e=s;switch(t){case Boolean:e=s!==null;break;case Number:e=s===null?null:Number(s);break;case Object:case Array:try{e=JSON.parse(s)}catch{e=null}}return e}},Pt=(s,t)=>!te(s,t),gt={attribute:!0,type:String,converter:nt,reflect:!1,hasChanged:Pt};Symbol.metadata??=Symbol("metadata"),Y.litPropertyMetadata??=new WeakMap;class N extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=gt){if(e.state&&(e.attribute=!1),this._$Ei(),this.elementProperties.set(t,e),!e.noAccessor){const o=Symbol(),n=this.getPropertyDescriptor(t,o,e);n!==void 0&&ee(this.prototype,t,n)}}static getPropertyDescriptor(t,e,o){const{get:n,set:i}=oe(this.prototype,t)??{get(){return this[e]},set(a){this[e]=a}};return{get(){return n?.call(this)},set(a){const l=n?.call(this);i.call(this,a),this.requestUpdate(t,l,o)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??gt}static _$Ei(){if(this.hasOwnProperty(H("elementProperties")))return;const t=ie(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(H("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(H("properties"))){const e=this.properties,o=[...se(e),...ne(e)];for(const n of o)this.createProperty(n,e[n])}const t=this[Symbol.metadata];if(t!==null){const e=litPropertyMetadata.get(t);if(e!==void 0)for(const[o,n]of e)this.elementProperties.set(o,n)}this._$Eh=new Map;for(const[e,o]of this.elementProperties){const n=this._$Eu(e,o);n!==void 0&&this._$Eh.set(n,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const o=new Set(t.flat(1/0).reverse());for(const n of o)e.unshift(ft(n))}else t!==void 0&&e.push(ft(t));return e}static _$Eu(t,e){const o=e.attribute;return o===!1?void 0:typeof o=="string"?o:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(t=>t(this))}addController(t){(this._$EO??=new Set).add(t),this.renderRoot!==void 0&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const o of e.keys())this.hasOwnProperty(o)&&(t.set(o,this[o]),delete this[o]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Jt(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(t=>t.hostConnected?.())}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach(t=>t.hostDisconnected?.())}attributeChangedCallback(t,e,o){this._$AK(t,o)}_$EC(t,e){const o=this.constructor.elementProperties.get(t),n=this.constructor._$Eu(t,o);if(n!==void 0&&o.reflect===!0){const i=(o.converter?.toAttribute!==void 0?o.converter:nt).toAttribute(e,o.type);this._$Em=t,i==null?this.removeAttribute(n):this.setAttribute(n,i),this._$Em=null}}_$AK(t,e){const o=this.constructor,n=o._$Eh.get(t);if(n!==void 0&&this._$Em!==n){const i=o.getPropertyOptions(n),a=typeof i.converter=="function"?{fromAttribute:i.converter}:i.converter?.fromAttribute!==void 0?i.converter:nt;this._$Em=n,this[n]=a.fromAttribute(e,i.type),this._$Em=null}}requestUpdate(t,e,o){if(t!==void 0){if(o??=this.constructor.getPropertyOptions(t),!(o.hasChanged??Pt)(this[t],e))return;this.P(t,e,o)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(t,e,o){this._$AL.has(t)||this._$AL.set(t,e),o.reflect===!0&&this._$Em!==t&&(this._$Ej??=new Set).add(t)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[n,i]of this._$Ep)this[n]=i;this._$Ep=void 0}const o=this.constructor.elementProperties;if(o.size>0)for(const[n,i]of o)i.wrapped!==!0||this._$AL.has(n)||this[n]===void 0||this.P(n,this[n],i)}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),this._$EO?.forEach(o=>o.hostUpdate?.()),this.update(e)):this._$EU()}catch(o){throw t=!1,this._$EU(),o}t&&this._$AE(e)}willUpdate(t){}_$AE(t){this._$EO?.forEach(e=>e.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Ej&&=this._$Ej.forEach(e=>this._$EC(e,this[e])),this._$EU()}updated(t){}firstUpdated(t){}}N.elementStyles=[],N.shadowRootOptions={mode:"open"},N[H("elementProperties")]=new Map,N[H("finalized")]=new Map,ce?.({ReactiveElement:N}),(Y.reactiveElementVersions??=[]).push("2.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class G extends N{constructor(){super(...arguments),this.renderOptions={host:this},this.o=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this.o=It(e,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this.o?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this.o?.setConnected(!1)}render(){return Ct}}G._$litElement$=!0,G.finalized=!0,globalThis.litElementHydrateSupport?.({LitElement:G});const re=globalThis.litElementPolyfillSupport;re?.({LitElement:G});(globalThis.litElementVersions??=[]).push("4.1.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const le=s=>(t,e)=>{e!==void 0?e.addInitializer(()=>{customElements.define(s,t)}):customElements.define(s,t)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ve=(s,t,e)=>(e.configurable=!0,e.enumerable=!0,Reflect.decorate&&typeof t!="object"&&Object.defineProperty(s,t,e),e);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function ye(s){return(t,e)=>{const{slot:o,selector:n}=s??{},i="slot"+(o?`[name=${o}]`:":not([name])");return ve(t,e,{get(){const a=this.renderRoot?.querySelector(i),l=a?.assignedElements(s)??[];return n===void 0?l:l.filter(c=>c.matches(n))}})}}var de=Object.defineProperty,he=Object.getOwnPropertyDescriptor,Dt=(s,t,e,o)=>{for(var n=o>1?void 0:o?he(t,e):t,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(o?a(t,e,n):a(n))||n);return o&&n&&de(t,e,n),n};let K=class extends G{constructor(){super(...arguments),this.callbacks={show:{},hide:{}}}static get ready(){return customElements.whenDefined("my-scene")}set(s){this.views.forEach(t=>{const e=t.getAttribute("name");if(e)if(e==s){if(t.hasAttribute("active"))return;this.callbacks.show[s]?.(),t.setAttribute("active","")}else t.hasAttribute("active")&&(t.removeAttribute("active"),this.callbacks.hide[e]?.())})}get(){return this.views.find(s=>s.hasAttribute("active"))?.getAttribute("name")}on(s,t,e){this.callbacks[s][t]=e}render(){return Tt`<slot></slot>`}};Dt([ye({slot:""})],K.prototype,"views",2);K=Dt([le("my-scene")],K);const ue=K;function fe(){const s=navigator.userAgent;return s.indexOf("Win")!==-1?"Windows":s.indexOf("Mac")!==-1&&s.indexOf("iPhone")===-1&&s.indexOf("iPad")===-1?"MacOS":s.indexOf("Linux")!==-1&&s.indexOf("Android")===-1?"Linux":/Android/i.test(s)?"Android":/iPhone|iPad|iPod/i.test(s)?"iOS":"Unknown"}let pe=qt(St());console.log(`pack size: ${pe}`);const ge=_("#connect-problem-note"),me=_("#browser-support-note"),M=_("#button-connect"),Ee=_(".button-disconnect"),be=_("#device-name"),ct=_("#device-connection-status"),_e=_(".update-version-device"),we=_(".update-buttons"),J=_("#upload-status"),Ut=_("#changelog"),mt=_("#show-advanced"),Se=_("#upload-samples"),Et=_("#upload-samples-status"),$t="MONKEY",P=new Ht,it=new Gt(P),j=new Zt(P);let bt=null,tt,Z=!1,Rt=null,U=null,L=null;const Ot=document.getElementById("scene-main"),_t=document.getElementById("scene-bluetooth"),wt=document.getElementById("scene-utility-tools"),z=document.getElementById("scene-updater");ue.ready.then(()=>{if(navigator&&navigator.bluetooth&&navigator.bluetooth.getAvailability())_t.set("available");else{const s={MacOS:"On <u>macOS</u> we recommend to use Chrome or a Chrome based browser.",Windows:"On <u>Windows</u> we recommend to use Chrome or a Chrome based browser.",Linux:"On <u>Linux</u> we recommend to use Chrome or a Chrome based browser.",Android:"On <u>Android</u> we recommend to use Chrome or a Chrome based browser.",iOS:"On iPhone and iPad you can use a browser named <u>Bluefy</u>.",Unknown:"We recommend to use Chrome or a Chrome based browser."},t=fe();me.innerHTML=s[t],_t.set("unavailable")}});P.onDeviceSelection=()=>{M.disabled=!0};P.onDeviceSelectionCancel=()=>{M.disabled=!1,ge.classList.remove("hidden")};P.onConnecting=()=>{M.disabled=!0,M.innerText="Connecting..."};P.onConnect=()=>{console.log("device connected"),ct.style.backgroundColor="#45C367",be.innerText=P.name,(async()=>(Pe(),await Lt(),await rt()))(),Ot.set("connected")};const Ae=M.innerText;P.onDisconnect=()=>{M.disabled=!1,M.innerText=Ae,Ot.set("disconnected"),Ut.innerHTML=""};P.onConnectionLoss=()=>ct.style.backgroundColor="#E89209";P.onConnectionReestablished=async()=>{console.log("device reconnected"),ct.style.backgroundColor="#45C367",Rt?.(null),(async()=>(z.get()!="updating"&&await Lt(),await rt()))()};async function rt(){console.log("checking sample manager state");try{console.log("checking if samples is set on device");const s=await j.isSet();console.log(`is set: ${s}`),s||(console.log("no samples are set, setting default"),await Mt()),bt=await j.getIDs(),tt=await j.getSpaceUsed(),console.log(`space used: ${tt}`),document.querySelector("#device-tools-header nav").innerHTML=`
			<a href="#device-update" active>Device update</a>
			<a href="#sample-manager">Sample manager</a>
		`,window.addEventListener("hashchange",et),et()}catch{bt=null,tt=null,document.querySelector("#device-tools-header nav").innerHTML="",window.removeEventListener("hashchange",et)}}_("#upload-samples-state").addEventListener("click",()=>{rt()});function et(){const s=window.location.hash;(s==null||s=="")&&(window.location.hash="#device-update"),document.querySelectorAll("nav a").forEach(e=>{e.removeAttribute("active")});const t=document.querySelector(`nav a[href="${s}"]`);t&&t.setAttribute("active",""),s==="#device-update"?wt.set("device-update"):s==="#sample-manager"&&wt.set("sample-manager")}M.addEventListener("click",async()=>{let t=[{namePrefix:"WAVY MONKEY",services:["03B80E5A-EDE8-4B33-A751-6CE34EC4C700".toLowerCase()]}];await P.connect(t)});Ee.forEach(s=>{s.addEventListener("click",async()=>{P.disconnect()})});mt.addEventListener("change",()=>{Z=mt.checked,W()});we.forEach(s=>{s.addEventListener("click",De)});Se.addEventListener("click",Mt);async function Pe(){const t=await(await fetch(`/firmware/${$t}/changelog.md`)).text();U=zt(t),console.log(U),W()}async function Lt(){try{L=await it.getFirmwareVersion(),W()}catch(s){console.log("Failed to get firmware version: "+s)}}function W(){if(!L||!U)return;_e.forEach(i=>{i.innerText=L.versionString}),_(".update-version-to").forEach(i=>{i.innerText=Z&&q(U.release,U.dev)?U.dev.versionString+" [BETA]":U.release.versionString});let t=!1,e=!0,o=!1,n="";U.versions.forEach(i=>{if(i.isDev&&!Z||i.isObsolete)return;const a=q(L,i.version),l=L.versionString===i.version.versionString;a&&(t=!0),(a||l)&&(e=!1),!a&&o&&(n+='<hr width="100%" />'),o=a,n+=`
            <div class="changelog-item" style="${i.isDev?"background-color: #eee;":""}"" ${a?"new":""}>
                <p><b>${i.version.versionString}${i.highlight?" "+i.highlight:""}${i.isDev?" [BETA]":""}</b><span><i>${i.date??""}</i></span></p>
                ${i.changes.map(c=>`- ${c}<br/>`).join("")}
            </div>
        `}),Ut.innerHTML=n,t?z.set("update-available"):e?z.set("downgrade-available"):z.set("updated")}async function De(){try{const s=_("#update-stage-fetch"),t=_("#update-stage-uploading"),e=_("#update-stage-applying"),o=_("#update-stage-verifying"),n=_("#update-stage-done");s.removeAttribute("active"),t.removeAttribute("active"),e.removeAttribute("active"),o.removeAttribute("active"),n.removeAttribute("active"),s.removeAttribute("done"),t.removeAttribute("done"),e.removeAttribute("done"),o.removeAttribute("done"),n.removeAttribute("done"),J.innerText="",z.set("updating"),s.setAttribute("active","");const i=Z?U.dev.versionString:U.release.versionString,a=await fetch(`/firmware/${$t}/app_update_${i}.bin`).then(p=>p.arrayBuffer());if(s.removeAttribute("active"),s.setAttribute("done",""),t.setAttribute("active",""),J.innerText="(preparing)",!await it.uploadImage(a,p=>{J.innerText=`(${p}%)`}))throw"failed to update";t.removeAttribute("active"),t.setAttribute("done","");const c=new Promise((p,h)=>Rt=p);if(e.setAttribute("active",""),await c,e.removeAttribute("active"),e.setAttribute("done",""),o.setAttribute("active",""),L=await it.getFirmwareVersion(),L.versionString!=i)throw new Error(`Update failed: Device firmware version is ${L.versionString} but expected ${i}`);o.removeAttribute("active"),o.setAttribute("done",""),n.setAttribute("done",""),await new Promise((p,h)=>setTimeout(p,2e3)),W()}catch(s){console.error(s),W()}}async function Mt(){try{await j.uploadSamples(St(),s=>Et.innerHTML=`${s}%`)}catch(s){console.error(s),Et.innerHTML="Failed to upload"}}
